{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma; "],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/app/api/admin/project-contacts/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { prisma } from '@/lib/db';\n\nconst projectContactSchema = z.object({\n  projectId: z.number(),\n  contactId: z.number(),\n  isPrimary: z.boolean().optional().default(false),\n  consultantType: z.string().optional(),\n});\n\n// GET - Fetch project contacts for a specific project\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const projectId = searchParams.get('projectId');\n    \n    if (!projectId) {\n      return NextResponse.json(\n        { success: false, error: 'Project ID is required' },\n        { status: 400 }\n      );\n    }\n\n    const projectContacts = await prisma.projectContact.findMany({\n      where: {\n        projectId: parseInt(projectId),\n      },\n      include: {\n        contact: true,\n      },\n      orderBy: {\n        isPrimary: 'desc', // Primary contacts first\n      },\n    });\n\n    return NextResponse.json({ success: true, data: projectContacts });\n  } catch (error) {\n    console.error('Error fetching project contacts:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch project contacts' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Create new project contact relationship\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const validatedData = projectContactSchema.parse(body);\n\n    // Check if relationship already exists for this specific consultant type\n    const existingRelationship = await prisma.projectContact.findFirst({\n      where: {\n        projectId: validatedData.projectId,\n        contactId: validatedData.contactId,\n        consultantType: validatedData.consultantType,\n      },\n    });\n\n    if (existingRelationship) {\n      return NextResponse.json(\n        { success: false, error: 'Contact is already associated with this project' },\n        { status: 400 }\n      );\n    }\n\n    // If this contact is being marked as primary, unmark other primary contacts for the same consultant type\n    if (validatedData.isPrimary) {\n      await prisma.projectContact.updateMany({\n        where: {\n          projectId: validatedData.projectId,\n          consultantType: validatedData.consultantType, // Only same consultant type\n          isPrimary: true,\n        },\n        data: {\n          isPrimary: false,\n        },\n      });\n    }\n\n    const projectContact = await prisma.projectContact.create({\n      data: validatedData,\n      include: {\n        contact: true,\n      },\n    });\n\n    return NextResponse.json({ success: true, data: projectContact });\n  } catch (error) {\n    console.error('Error creating project contact:', error);\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { success: false, error: 'Validation error', details: error.errors },\n        { status: 400 }\n      );\n    }\n    return NextResponse.json(\n      { success: false, error: 'Failed to create project contact' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update project contact relationship\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { id, isPrimary, consultantType } = body;\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Project contact ID is required' },\n        { status: 400 }\n      );\n    }\n\n    // If this contact is being marked as primary, unmark other primary contacts for the same consultant type\n    if (isPrimary) {\n      const projectContact = await prisma.projectContact.findUnique({\n        where: { id: parseInt(id) },\n      });\n\n      if (projectContact) {\n        // Only unmark primary contacts for the same consultant type\n        await prisma.projectContact.updateMany({\n          where: {\n            projectId: projectContact.projectId,\n            consultantType: projectContact.consultantType, // Only same consultant type\n            isPrimary: true,\n          },\n          data: {\n            isPrimary: false,\n          },\n        });\n      }\n    }\n\n    const updateData: any = {};\n    if (isPrimary !== undefined) updateData.isPrimary = isPrimary;\n    if (consultantType !== undefined) updateData.consultantType = consultantType;\n\n    const updatedProjectContact = await prisma.projectContact.update({\n      where: { id: parseInt(id) },\n      data: updateData,\n      include: {\n        contact: true,\n      },\n    });\n\n    return NextResponse.json({ success: true, data: updatedProjectContact });\n  } catch (error) {\n    console.error('Error updating project contact:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to update project contact' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - Remove project contact relationship\nexport async function DELETE(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const id = searchParams.get('id');\n\n    if (!id) {\n      return NextResponse.json(\n        { success: false, error: 'Project contact ID is required' },\n        { status: 400 }\n      );\n    }\n\n    await prisma.projectContact.delete({\n      where: { id: parseInt(id) },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting project contact:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete project contact' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}