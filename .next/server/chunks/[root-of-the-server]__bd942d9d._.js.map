{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma; "],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/app/api/admin/projects/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/db';\n\n// GET - Fetch single project by ID\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const projectId = parseInt(id);\n    \n    if (isNaN(projectId)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid project ID' },\n        { status: 400 }\n      );\n    }\n\n    const project = await prisma.project.findUnique({\n      where: { id: projectId },\n      include: {\n        client: true,\n        projectManagementConsultant: true,\n        designConsultant: true,\n        supervisionConsultant: true,\n        costConsultant: true,\n        projectPositions: {\n          include: {\n            staffAssignments: {\n              include: {\n                staff: true,\n              },\n            },\n          },\n        },\n        projectContacts: true,\n        projectChecklistItems: true,\n      },\n    });\n\n    if (!project) {\n      return NextResponse.json(\n        { success: false, error: 'Project not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({ success: true, data: project });\n  } catch (error) {\n    console.error('Error fetching project:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch project' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update project\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const projectId = parseInt(id);\n    \n    if (isNaN(projectId)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid project ID' },\n        { status: 400 }\n      );\n    }\n\n    const body = await request.json();\n    \n    // Extract staff fields that need special handling\n    const { projectDirectorId, projectManagerId, ...validBody } = body;\n    \n    // Convert date strings to DateTime objects if provided\n    const projectData = {\n      ...validBody,\n      startDate: validBody.startDate ? new Date(validBody.startDate) : null,\n      endDate: validBody.endDate ? new Date(validBody.endDate) : null,\n    };\n\n    // Use transaction to update project and handle staff assignments atomically\n    const result = await prisma.$transaction(async (tx) => {\n      // Update the project\n      const project = await tx.project.update({\n        where: { id: projectId },\n        data: projectData,\n        include: {\n          client: true,\n          projectManagementConsultant: true,\n          designConsultant: true,\n          supervisionConsultant: true,\n          costConsultant: true,\n          projectPositions: {\n            include: {\n              staffAssignments: {\n                include: {\n                  staff: true,\n                },\n              },\n            },\n          },\n          projectContacts: true,\n          projectChecklistItems: true,\n        },\n      });\n\n      // Handle Project Director assignment\n      if (projectDirectorId !== undefined) {\n        // Find or create the Project Director position\n        let directorPosition = await tx.projectPosition.findFirst({\n          where: {\n            projectId: projectId,\n            designation: 'Project Director',\n          },\n        });\n\n        if (!directorPosition) {\n          directorPosition = await tx.projectPosition.create({\n            data: {\n              projectId: projectId,\n              designation: 'Project Director',\n              requiredUtilization: 100,\n            },\n          });\n        }\n\n        // Remove any existing staff assignments for this position\n        await tx.projectStaff.deleteMany({\n          where: {\n            projectId: projectId,\n            positionId: directorPosition.id,\n          },\n        });\n\n        // If a new director is provided, create the assignment\n        if (projectDirectorId) {\n          await tx.projectStaff.create({\n            data: {\n              projectId: projectId,\n              positionId: directorPosition.id,\n              staffId: projectDirectorId,\n              utilization: 100,\n              status: 'Active',\n              startDate: projectData.startDate,\n              endDate: projectData.endDate,\n            },\n          });\n        }\n      }\n\n      // Handle Project Manager assignment\n      if (projectManagerId !== undefined) {\n        // Find or create the Project Manager position\n        let managerPosition = await tx.projectPosition.findFirst({\n          where: {\n            projectId: projectId,\n            designation: 'Project Manager',\n          },\n        });\n\n        if (!managerPosition) {\n          managerPosition = await tx.projectPosition.create({\n            data: {\n              projectId: projectId,\n              designation: 'Project Manager',\n              requiredUtilization: 100,\n            },\n          });\n        }\n\n        // Remove any existing staff assignments for this position\n        await tx.projectStaff.deleteMany({\n          where: {\n            projectId: projectId,\n            positionId: managerPosition.id,\n          },\n        });\n\n        // If a new manager is provided, create the assignment\n        if (projectManagerId) {\n          await tx.projectStaff.create({\n            data: {\n              projectId: projectId,\n              positionId: managerPosition.id,\n              staffId: projectManagerId,\n              utilization: 100,\n              status: 'Active',\n              startDate: projectData.startDate,\n              endDate: projectData.endDate,\n            },\n          });\n        }\n      }\n\n      // Return updated project with fresh staff data\n      return await tx.project.findUnique({\n        where: { id: projectId },\n        include: {\n          client: true,\n          projectManagementConsultant: true,\n          designConsultant: true,\n          supervisionConsultant: true,\n          costConsultant: true,\n          projectPositions: {\n            include: {\n              staffAssignments: {\n                include: {\n                  staff: true,\n                },\n              },\n            },\n          },\n          projectContacts: true,\n          projectChecklistItems: true,\n        },\n      });\n    });\n\n    return NextResponse.json({ success: true, data: result });\n  } catch (error) {\n    console.error('Error updating project:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to update project' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - Delete project\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const projectId = parseInt(id);\n    \n    if (isNaN(projectId)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid project ID' },\n        { status: 400 }\n      );\n    }\n\n    await prisma.project.delete({\n      where: { id: projectId },\n    });\n\n    return NextResponse.json({ success: true, message: 'Project deleted successfully' });\n  } catch (error) {\n    console.error('Error deleting project:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete project' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}}]
}