{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma; "],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/app/api/admin/company-staff/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { prisma } from '@/lib/db';\n\nconst staffSchema = z.object({\n  staffName: z.string().min(1, 'Staff name is required'),\n  email: z.string().email().optional().or(z.literal('')),\n  phone: z.string().optional(),\n  position: z.string().optional(),\n  isActive: z.boolean().optional().default(true),\n});\n\n// GET - Fetch all company staff\nexport async function GET() {\n  try {\n    const staff = await prisma.companyStaff.findMany({\n      include: {\n        projectStaff: {\n          include: {\n            project: {\n              select: {\n                id: true,\n                projectName: true,\n                projectCode: true,\n              },\n            },\n            position: {\n              select: {\n                id: true,\n                designation: true,\n                requiredUtilization: true,\n              },\n            },\n          },\n        },\n      },\n      orderBy: {\n        createdAt: 'desc',\n      },\n    });\n\n    // Calculate total utilization for each staff member\n    const staffWithUtilization = staff.map(member => {\n      const totalUtilization = member.projectStaff.reduce((sum, assignment) => sum + assignment.utilization, 0);\n      const remainingCapacity = Math.max(0, 100 - totalUtilization);\n      \n      return {\n        ...member,\n        totalUtilization,\n        remainingCapacity,\n      };\n    });\n\n    return NextResponse.json({ success: true, data: staffWithUtilization });\n  } catch (error) {\n    console.error('Error fetching company staff:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch company staff' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Create new company staff\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const validatedData = staffSchema.parse(body);\n\n    const staff = await prisma.companyStaff.create({\n      data: validatedData,\n      include: {\n        projectStaff: {\n          include: {\n            project: {\n              select: {\n                id: true,\n                projectName: true,\n                projectCode: true,\n              },\n            },\n            position: {\n              select: {\n                id: true,\n                designation: true,\n                requiredUtilization: true,\n              },\n            },\n          },\n        },\n      },\n    });\n\n    return NextResponse.json({ success: true, data: staff });\n  } catch (error) {\n    console.error('Error creating company staff:', error);\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { success: false, error: 'Validation error', details: error.errors },\n        { status: 400 }\n      );\n    }\n    return NextResponse.json(\n      { success: false, error: 'Failed to create company staff' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,cAAc,yKAAC,CAAC,MAAM,CAAC;IAC3B,WAAW,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC7B,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ,GAAG,EAAE,CAAC,yKAAC,CAAC,OAAO,CAAC;IAClD,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,UAAU,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,UAAU,yKAAC,CAAC,OAAO,GAAG,QAAQ,GAAG,OAAO,CAAC;AAC3C;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM,4HAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;YAC/C,SAAS;gBACP,cAAc;oBACZ,SAAS;wBACP,SAAS;4BACP,QAAQ;gCACN,IAAI;gCACJ,aAAa;gCACb,aAAa;4BACf;wBACF;wBACA,UAAU;4BACR,QAAQ;gCACN,IAAI;gCACJ,aAAa;gCACb,qBAAqB;4BACvB;wBACF;oBACF;gBACF;YACF;YACA,SAAS;gBACP,WAAW;YACb;QACF;QAEA,oDAAoD;QACpD,MAAM,uBAAuB,MAAM,GAAG,CAAC,CAAA;YACrC,MAAM,mBAAmB,OAAO,YAAY,CAAC,MAAM,CAAC,CAAC,KAAK,aAAe,MAAM,WAAW,WAAW,EAAE;YACvG,MAAM,oBAAoB,KAAK,GAAG,CAAC,GAAG,MAAM;YAE5C,OAAO;gBACL,GAAG,MAAM;gBACT;gBACA;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAqB;IACvE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAgC,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,gBAAgB,YAAY,KAAK,CAAC;QAExC,MAAM,QAAQ,MAAM,4HAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YAC7C,MAAM;YACN,SAAS;gBACP,cAAc;oBACZ,SAAS;wBACP,SAAS;4BACP,QAAQ;gCACN,IAAI;gCACJ,aAAa;gCACb,aAAa;4BACf;wBACF;wBACA,UAAU;4BACR,QAAQ;gCACN,IAAI;gCACJ,aAAa;gCACb,qBAAqB;4BACvB;wBACF;oBACF;gBACF;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAM;IACxD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,IAAI,iBAAiB,yKAAC,CAAC,QAAQ,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;gBAAoB,SAAS,MAAM,MAAM;YAAC,GACnE;gBAAE,QAAQ;YAAI;QAElB;QACA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAiC,GAC1D;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}