{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma; "],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/azarmacbook/Cursor%20Projects/PMP-%20Reports/src/app/api/admin/consultants/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { prisma } from '@/lib/db';\n\nconst consultantSchema = z.object({\n  name: z.string().min(1, 'Consultant name is required'),\n  officeAddress: z.string().optional(),\n  phone: z.string().optional(),\n  email: z.string().email().optional().or(z.literal('')),\n  isActive: z.boolean().optional().default(true),\n  types: z.array(z.number()).optional().default([]),\n});\n\n// GET - Fetch single consultant\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const consultantId = parseInt(params.id);\n    \n    if (isNaN(consultantId)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid consultant ID' },\n        { status: 400 }\n      );\n    }\n\n    const consultant = await prisma.consultant.findUnique({\n      where: { id: consultantId },\n      include: {\n        types: true,\n        projectsAsPMC: {\n          select: {\n            id: true,\n            projectName: true,\n            startDate: true,\n            endDate: true,\n          },\n        },\n        projectsAsDesign: {\n          select: {\n            id: true,\n            projectName: true,\n            startDate: true,\n            endDate: true,\n          },\n        },\n        projectsAsCost: {\n          select: {\n            id: true,\n            projectName: true,\n            startDate: true,\n            endDate: true,\n          },\n        },\n        projectsAsSupervision: {\n          select: {\n            id: true,\n            projectName: true,\n            startDate: true,\n            endDate: true,\n          },\n        },\n      },\n    });\n\n    if (!consultant) {\n      return NextResponse.json(\n        { success: false, error: 'Consultant not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({ success: true, data: consultant });\n  } catch (error) {\n    console.error('Error fetching consultant:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch consultant' },\n      { status: 500 }\n    );\n  }\n}\n\n// PUT - Update consultant\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const consultantId = parseInt(params.id);\n    \n    if (isNaN(consultantId)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid consultant ID' },\n        { status: 400 }\n      );\n    }\n\n    const body = await request.json();\n    const validatedData = consultantSchema.parse(body);\n\n    const { types, ...consultantData } = validatedData;\n\n    const consultant = await prisma.consultant.update({\n      where: { id: consultantId },\n      data: {\n        ...consultantData,\n        types: {\n          set: types.map(typeId => ({ id: typeId })),\n        },\n      },\n      include: {\n        types: true,\n        projectsAsPMC: {\n          select: {\n            id: true,\n            projectName: true,\n          },\n        },\n        projectsAsDesign: {\n          select: {\n            id: true,\n            projectName: true,\n          },\n        },\n        projectsAsCost: {\n          select: {\n            id: true,\n            projectName: true,\n          },\n        },\n        projectsAsSupervision: {\n          select: {\n            id: true,\n            projectName: true,\n          },\n        },\n      },\n    });\n\n    return NextResponse.json({ success: true, data: consultant });\n  } catch (error) {\n    console.error('Error updating consultant:', error);\n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { success: false, error: 'Validation error', details: error.errors },\n        { status: 400 }\n      );\n    }\n    return NextResponse.json(\n      { success: false, error: 'Failed to update consultant' },\n      { status: 500 }\n    );\n  }\n}\n\n// DELETE - Delete consultant\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const consultantId = parseInt(params.id);\n    \n    if (isNaN(consultantId)) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid consultant ID' },\n        { status: 400 }\n      );\n    }\n\n    // Check if consultant has associated projects\n    const projectsCount = await prisma.project.count({\n      where: {\n        OR: [\n          { projectManagementConsultantId: consultantId },\n          { designConsultantId: consultantId },\n          { supervisionConsultantId: consultantId },\n          { costConsultantId: consultantId },\n        ],\n      },\n    });\n\n    if (projectsCount > 0) {\n      return NextResponse.json(\n        { success: false, error: 'Cannot delete consultant with associated projects' },\n        { status: 400 }\n      );\n    }\n\n    await prisma.consultant.delete({\n      where: { id: consultantId },\n    });\n\n    return NextResponse.json({ success: true, message: 'Consultant deleted successfully' });\n  } catch (error) {\n    console.error('Error deleting consultant:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete consultant' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,mBAAmB,yKAAC,CAAC,MAAM,CAAC;IAChC,MAAM,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IACxB,eAAe,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAClC,OAAO,yKAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ,GAAG,EAAE,CAAC,yKAAC,CAAC,OAAO,CAAC;IAClD,UAAU,yKAAC,CAAC,OAAO,GAAG,QAAQ,GAAG,OAAO,CAAC;IACzC,OAAO,yKAAC,CAAC,KAAK,CAAC,yKAAC,CAAC,MAAM,IAAI,QAAQ,GAAG,OAAO,CAAC,EAAE;AAClD;AAGO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAA8B;IAEtC,IAAI;QACF,MAAM,eAAe,SAAS,OAAO,EAAE;QAEvC,IAAI,MAAM,eAAe;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAwB,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,4HAAM,CAAC,UAAU,CAAC,UAAU,CAAC;YACpD,OAAO;gBAAE,IAAI;YAAa;YAC1B,SAAS;gBACP,OAAO;gBACP,eAAe;oBACb,QAAQ;wBACN,IAAI;wBACJ,aAAa;wBACb,WAAW;wBACX,SAAS;oBACX;gBACF;gBACA,kBAAkB;oBAChB,QAAQ;wBACN,IAAI;wBACJ,aAAa;wBACb,WAAW;wBACX,SAAS;oBACX;gBACF;gBACA,gBAAgB;oBACd,QAAQ;wBACN,IAAI;wBACJ,aAAa;wBACb,WAAW;wBACX,SAAS;oBACX;gBACF;gBACA,uBAAuB;oBACrB,QAAQ;wBACN,IAAI;wBACJ,aAAa;wBACb,WAAW;wBACX,SAAS;oBACX;gBACF;YACF;QACF;QAEA,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAuB,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAW;IAC7D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA6B,GACtD;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAA8B;IAEtC,IAAI;QACF,MAAM,eAAe,SAAS,OAAO,EAAE;QAEvC,IAAI,MAAM,eAAe;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAwB,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,gBAAgB,iBAAiB,KAAK,CAAC;QAE7C,MAAM,EAAE,KAAK,EAAE,GAAG,gBAAgB,GAAG;QAErC,MAAM,aAAa,MAAM,4HAAM,CAAC,UAAU,CAAC,MAAM,CAAC;YAChD,OAAO;gBAAE,IAAI;YAAa;YAC1B,MAAM;gBACJ,GAAG,cAAc;gBACjB,OAAO;oBACL,KAAK,MAAM,GAAG,CAAC,CAAA,SAAU,CAAC;4BAAE,IAAI;wBAAO,CAAC;gBAC1C;YACF;YACA,SAAS;gBACP,OAAO;gBACP,eAAe;oBACb,QAAQ;wBACN,IAAI;wBACJ,aAAa;oBACf;gBACF;gBACA,kBAAkB;oBAChB,QAAQ;wBACN,IAAI;wBACJ,aAAa;oBACf;gBACF;gBACA,gBAAgB;oBACd,QAAQ;wBACN,IAAI;wBACJ,aAAa;oBACf;gBACF;gBACA,uBAAuB;oBACrB,QAAQ;wBACN,IAAI;wBACJ,aAAa;oBACf;gBACF;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAW;IAC7D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,IAAI,iBAAiB,yKAAC,CAAC,QAAQ,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;gBAAoB,SAAS,MAAM,MAAM;YAAC,GACnE;gBAAE,QAAQ;YAAI;QAElB;QACA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA8B,GACvD;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,OACpB,OAAoB,EACpB,EAAE,MAAM,EAA8B;IAEtC,IAAI;QACF,MAAM,eAAe,SAAS,OAAO,EAAE;QAEvC,IAAI,MAAM,eAAe;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAwB,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,8CAA8C;QAC9C,MAAM,gBAAgB,MAAM,4HAAM,CAAC,OAAO,CAAC,KAAK,CAAC;YAC/C,OAAO;gBACL,IAAI;oBACF;wBAAE,+BAA+B;oBAAa;oBAC9C;wBAAE,oBAAoB;oBAAa;oBACnC;wBAAE,yBAAyB;oBAAa;oBACxC;wBAAE,kBAAkB;oBAAa;iBAClC;YACH;QACF;QAEA,IAAI,gBAAgB,GAAG;YACrB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAoD,GAC7E;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,4HAAM,CAAC,UAAU,CAAC,MAAM,CAAC;YAC7B,OAAO;gBAAE,IAAI;YAAa;QAC5B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAkC;IACvF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA8B,GACvD;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}