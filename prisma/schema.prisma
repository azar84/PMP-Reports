generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SiteSettings {
  id                       Int      @id @default(autoincrement())
  logoUrl                  String?
  logoLightUrl             String?
  logoDarkUrl              String?
  faviconUrl               String?
  faviconLightUrl          String?
  faviconDarkUrl           String?
  smtpEnabled              Boolean  @default(false)
  smtpHost                 String?
  smtpPort                 Int?     @default(587)
  smtpSecure               Boolean  @default(true)
  smtpUsername             String?
  smtpPassword             String?
  smtpFromEmail            String?
  smtpFromName             String?
  smtpReplyTo              String?
  emailSignature           String?
  emailFooterText          String?
  emailBrandingEnabled     Boolean  @default(true)
  adminNotificationEmail   String?
  emailLoggingEnabled      Boolean  @default(true)
  emailRateLimitPerHour    Int?     @default(100)
  companyPhone             String?
  companyEmail             String?
  companyAddress           String?
  socialFacebook           String?
  socialTwitter            String?
  socialLinkedin           String?
  socialInstagram          String?
  socialYoutube            String?
  footerNewsletterFormId   Int?
  footerCopyrightMessage   String?
  footerMenuIds            String?
  footerShowContactInfo    Boolean  @default(true)
  footerShowSocialLinks    Boolean  @default(true)
  footerCompanyName        String?
  footerCompanyDescription String?
  footerBackgroundColor    String?  @default("#F9FAFB")
  footerTextColor          String?  @default("#374151")
  baseUrl                  String?  @default("")
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  gaMeasurementId          String?  @default("NULL")
  gtmContainerId           String?  @default("NULL")
  gtmEnabled               Boolean  @default(false)
  cloudinaryApiKey         String?
  cloudinaryApiSecret      String?
  cloudinaryCloudName      String?
  cloudinaryEnabled        Boolean  @default(false)
  cloudinaryUploadPreset   String?
  sidebarBackgroundColor   String?  @default("#1F2937")
  sidebarHoverColor        String?  @default("#D1D5DB")
  sidebarSelectedColor     String?  @default("#FFFFFF")
  sidebarTextColor         String?  @default("#E5E7EB")
  currencySymbol           String?  @default("$")
  vatPercent               Decimal? @default(5)

  @@map("site_settings")
}

model ServiceAccountCredentials {
  id                      Int      @id @default(autoincrement())
  projectId               String
  clientEmail             String
  privateKey              String
  privateKeyId            String
  clientId                String
  authUri                 String
  tokenUri                String
  authProviderX509CertUrl String
  clientX509CertUrl       String
  universeDomain          String
  isActive                Boolean  @default(true)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @default(now()) @updatedAt

  @@map("service_account_credentials")
}

model SitemapSubmissionLog {
  id             String   @id @default(cuid())
  sitemapUrl     String
  siteUrl        String
  submittedAt    DateTime @default(now())
  status         String
  searchEngine   String
  googleResponse String?
  errorMessage   String?
  statusCode     Int?
  submissionId   String?
  warnings       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now()) @updatedAt

  @@map("sitemap_submission_logs")
}

model DesignSystem {
  id                           Int      @id @default(autoincrement())
  primaryColor                 String   @default("#EF2908")
  primaryColorLight            String   @default("#FF4013")
  primaryColorDark             String   @default("#C71508")
  secondaryColor               String   @default("#FFFFFF")
  accentColor                  String   @default("#06B6D4")
  successColor                 String   @default("#10B981")
  warningColor                 String   @default("#F59E0B")
  errorColor                   String   @default("#EF4444")
  infoColor                    String   @default("#3B82F6")
  borderLight                  String   @default("#EBEBEB")
  borderStrong                 String   @default("#D6D6D6")
  backgroundPrimary            String   @default("#FFFFFF")
  backgroundSecondary          String   @default("#F5F8F8")
  backgroundDark               String   @default("#F1F1F1")
  headerBackgroundColor        String   @default("#FF2600")
  sidebarHeaderBackgroundColor String   @default("#FF2600")
  sidebarBackgroundColor       String   @default("#FFFFFF")
  textPrimary                  String   @default("#4B5563")
  textSecondary                String   @default("#9CA3AF")
  textMuted                    String   @default("#AAAAAA")
  headerTextColor              String   @default("#FFFFFF")
  sidebarTextColor             String   @default("#000000")
  sidebarHeaderColor           String   @default("#FFFFFF")
  fontFamily                   String   @default("Manrope")
  fontFamilyMono               String   @default("ui-monospace")
  fontSizeBase                 String   @default("16px")
  lineHeightBase               String   @default("1.5")
  fontWeightNormal             String   @default("400")
  fontWeightMedium             String   @default("500")
  fontWeightBold               String   @default("700")
  spacingXs                    String   @default("4px")
  spacingSm                    String   @default("8px")
  spacingMd                    String   @default("16px")
  spacingLg                    String   @default("24px")
  spacingXl                    String   @default("32px")
  spacing2xl                   String   @default("48px")
  borderRadiusSm               String   @default("4px")
  borderRadiusMd               String   @default("8px")
  borderRadiusLg               String   @default("12px")
  borderRadiusXl               String   @default("16px")
  borderRadiusFull             String   @default("9999px")
  shadowSm                     String   @default("0 1px 2px 0 rgb(0 0 0 / 0.05)")
  shadowMd                     String   @default("0 4px 6px -1px rgb(0 0 0 / 0.1)")
  shadowLg                     String   @default("0 10px 15px -3px rgb(0 0 0 / 0.1)")
  shadowXl                     String   @default("0 20px 25px -5px rgb(0 0 0 / 0.1)")
  animationFast                String   @default("150ms")
  animationNormal              String   @default("300ms")
  animationSlow                String   @default("500ms")
  breakpointSm                 String   @default("640px")
  breakpointMd                 String   @default("768px")
  breakpointLg                 String   @default("1024px")
  breakpointXl                 String   @default("1280px")
  breakpoint2xl                String   @default("1536px")
  themeMode                    String   @default("light")
  customVariables              String?
  isActive                     Boolean  @default(true)
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt

  @@map("design_system")
}

model MediaLibrary {
  id              Int              @id @default(autoincrement())
  filename        String
  title           String?
  description     String?
  alt             String?
  fileType        String
  mimeType        String
  fileSize        Int
  width           Int?
  height          Int?
  duration        Float?
  originalUrl     String
  localPath       String?
  publicUrl       String
  thumbnailUrl    String?
  folderId        Int?
  tags            String?
  uploadSource    String           @default("upload")
  uploadedBy      String?
  isActive        Boolean          @default(true)
  isPublic        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  folder          MediaFolder?     @relation(fields: [folderId], references: [id])
  usages          MediaUsage[]
  projectPictures ProjectPicture[]

  @@map("media_library")
}

model MediaFolder {
  id          Int            @id @default(autoincrement())
  name        String
  description String?
  parentId    Int?
  color       String         @default("#5243E9")
  sortOrder   Int            @default(0)
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  parent      MediaFolder?   @relation("FolderHierarchy", fields: [parentId], references: [id])
  children    MediaFolder[]  @relation("FolderHierarchy")
  media       MediaLibrary[]

  @@map("media_folders")
}

model MediaUsage {
  id         Int          @id @default(autoincrement())
  mediaId    Int
  entityType String
  entityId   Int
  fieldName  String
  createdAt  DateTime     @default(now())
  media      MediaLibrary @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([mediaId, entityType, entityId, fieldName])
  @@map("media_usage")
}

model Tenant {
  id          Int            @id @default(autoincrement())
  name        String
  slug        String         @unique
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  users       AdminUser[]
  auditLogs   AuditLog[]
  clients     Client[]
  staff       CompanyStaff[]
  consultants Consultant[]
  labours     Labour[]
  permissions Permission[]
  plants      Plant[]
  projects    Project[]
  roles       Role[]
  suppliers   Supplier[]

  @@index([slug])
  @@map("tenants")
}

model AdminUser {
  id                   Int                 @id @default(autoincrement())
  tenantId             Int                 @default(1)
  username             String
  email                String
  passwordHash         String
  name                 String?
  role                 String              @default("admin")
  isActive             Boolean             @default(true)
  hasAllProjectsAccess Boolean             @default(false)
  lastLoginAt          DateTime?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  tenant               Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectMemberships   ProjectMembership[]
  projectReports       ProjectReport[]
  userRoles            UserRole[]

  @@unique([tenantId, username])
  @@unique([tenantId, email])
  @@index([tenantId])
  @@map("admin_users")
}

model Permission {
  id              Int              @id @default(autoincrement())
  tenantId        Int              @default(1)
  key             String
  resource        String
  description     String?
  isSystem        Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rolePermissions RolePermission[]

  @@unique([tenantId, key])
  @@index([tenantId])
  @@index([resource])
  @@map("permissions")
}

model Role {
  id              Int              @id @default(autoincrement())
  tenantId        Int
  name            String
  description     String?
  isSystem        Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  rolePermissions RolePermission[]
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  userRoles       UserRole[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("roles")
}

model RolePermission {
  id           Int        @id @default(autoincrement())
  roleId       Int
  permissionId Int
  action       String     @default("allow")
  createdAt    DateTime   @default(now())
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@map("role_permissions")
}

model UserRole {
  id        Int       @id @default(autoincrement())
  userId    Int
  roleId    Int
  createdAt DateTime  @default(now())
  role      Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user      AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@map("user_roles")
}

model ProjectMembership {
  id        Int       @id @default(autoincrement())
  userId    Int
  projectId Int
  createdAt DateTime  @default(now())
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user      AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, projectId])
  @@index([userId])
  @@index([projectId])
  @@map("project_memberships")
}

model AuditLog {
  id         Int      @id @default(autoincrement())
  tenantId   Int
  userId     Int?
  action     String
  resource   String
  resourceId Int?
  details    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([action])
  @@index([resource, resourceId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Client {
  id            Int       @id @default(autoincrement())
  tenantId      Int       @default(1)
  name          String
  officeAddress String?
  phone         String?
  email         String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projects      Project[]

  @@index([tenantId])
  @@map("clients")
}

model Consultant {
  id                         Int                          @id @default(autoincrement())
  tenantId                   Int                          @default(1)
  name                       String
  officeAddress              String?
  phone                      String?
  email                      String?
  isActive                   Boolean                      @default(true)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  ConsultantToConsultantType ConsultantToConsultantType[]
  tenant                     Tenant                       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectsAsCost             Project[]                    @relation("CostConsultant")
  projectsAsDesign           Project[]                    @relation("DesignConsultant")
  projectsAsPMC              Project[]                    @relation("ProjectManagementConsultant")
  projectsAsSupervision      Project[]                    @relation("SupervisionConsultant")

  @@index([tenantId])
  @@map("consultants")
}

model ConsultantType {
  id                         Int                          @id @default(autoincrement())
  type                       String                       @unique
  description                String?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  ConsultantToConsultantType ConsultantToConsultantType[]

  @@map("consultant_types")
}

model CompanyStaff {
  id                 Int                    @id @default(autoincrement())
  tenantId           Int                    @default(1)
  staffName          String
  email              String?
  phone              String?
  position           String?
  isActive           Boolean                @default(true)
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  employeeNumber     String?
  vacationStartDate  DateTime?
  vacationEndDate    DateTime?
  monthlyBaseRate    Decimal?
  tenant             Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  leaveHistory       LeaveHistory[]         @relation("StaffLeaveHistory")
  projectStaff       ProjectStaff[]
  projectsAsDirector Project[]              @relation("ProjectDirector")
  projectsAsManager  Project[]              @relation("ProjectManager")
  movementHistory    StaffMovementHistory[]

  @@index([tenantId])
  @@map("company_staff")
}

model Contact {
  id              Int              @id @default(autoincrement())
  firstName       String
  lastName        String
  email           String?
  phone           String?
  position        String?
  notes           String?
  isActive        Boolean          @default(true)
  entityType      String
  entityId        Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  projectContacts ProjectContact[]

  @@map("contacts")
}

model ProjectContact {
  id             Int      @id @default(autoincrement())
  projectId      Int
  contactId      Int
  isPrimary      Boolean  @default(false)
  consultantType String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  contact        Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, contactId, consultantType])
  @@map("project_contacts")
}

model Project {
  id                                 Int                                 @id @default(autoincrement())
  tenantId                           Int                                 @default(1)
  projectCode                        String
  projectName                        String
  projectDescription                 String?
  clientId                           Int?
  projectManagementConsultantId      Int?
  designConsultantId                 Int?
  supervisionConsultantId            Int?
  costConsultantId                   Int?
  projectDirectorId                  Int?
  projectManagerId                   Int?
  startDate                          DateTime?                           @db.Date
  endDate                            DateTime?                           @db.Date
  duration                           String?
  projectValue                       Decimal
  status                             String                              @default("ongoing")
  advancePaymentPercentage           Decimal?
  retentionPercentage                Decimal?
  paymentTermsDays                   Int?
  lastUpdate                         DateTime                            @default(now()) @updatedAt
  createdAt                          DateTime                            @default(now())
  updatedAt                          DateTime                            @updatedAt
  areaOfConcerns                     ProjectAreaOfConcern[]
  projectAssets                      ProjectAsset[]
  projectChecklistItems              ProjectChecklistItem[]
  clientFeedback                     ProjectClientFeedback?
  closeOutEntries                    ProjectCloseOutEntry[]
  projectCommercial                  ProjectCommercial?
  projectCommercialChecklistItems    ProjectCommercialChecklistItem[]
  projectContacts                    ProjectContact[]
  controlMilestones                  ProjectControlMilestone[]
  grns                               ProjectGRN[]
  hseChecklistItems                  ProjectHseChecklistItem[]
  invoices                           ProjectInvoice[]
  ipcEntries                         ProjectIPC[]
  projectLabourSupplies              ProjectLabourSupply[]
  projectLabours                     ProjectLabour[]
  projectMemberships                 ProjectMembership[]
  nocTrackerEntries                  ProjectNocTrackerEntry[]
  projectPictures                    ProjectPicture[]
  projectPlanning                    ProjectPlanning?
  plantRequirements                  ProjectPlantRequirement[]
  projectPlants                      ProjectPlant[]
  projectPositions                   ProjectPosition[]
  purchaseOrders                     ProjectPurchaseOrder[]
  qualityChecklistEntries            ProjectQualityChecklistEntry[]
  qualityE1Logs                      ProjectQualityE1Log[]
  qualityE2Logs                      ProjectQualityE2Log[]
  projectReports                     ProjectReport[]
  projectRisks                       ProjectRiskEntry[]
  projectStaff                       ProjectStaff[]
  projectSubcontractorChangeOrders   ProjectSubcontractorChangeOrder[]
  projectSubcontractorInvoices       ProjectSubcontractorInvoice[]
  projectSubcontractorPayments       ProjectSubcontractorPayment[]
  projectSubcontractorPurchaseOrders ProjectSubcontractorPurchaseOrder[]
  projectSubcontractors              ProjectSubcontractor[]
  payments                           ProjectSupplierPayment[]
  projectSuppliers                   ProjectSupplier[]
  projectTrades                      ProjectTrade[]
  projectVendorEvaluations           ProjectVendorEvaluation[]
  client                             Client?                             @relation(fields: [clientId], references: [id])
  costConsultant                     Consultant?                         @relation("CostConsultant", fields: [costConsultantId], references: [id])
  designConsultant                   Consultant?                         @relation("DesignConsultant", fields: [designConsultantId], references: [id])
  projectDirector                    CompanyStaff?                       @relation("ProjectDirector", fields: [projectDirectorId], references: [id])
  projectManagementConsultant        Consultant?                         @relation("ProjectManagementConsultant", fields: [projectManagementConsultantId], references: [id])
  projectManager                     CompanyStaff?                       @relation("ProjectManager", fields: [projectManagerId], references: [id])
  supervisionConsultant              Consultant?                         @relation("SupervisionConsultant", fields: [supervisionConsultantId], references: [id])
  tenant                             Tenant                              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, projectCode])
  @@index([tenantId])
  @@map("projects")
}

model ProjectPlanning {
  id                 Int                       @id @default(autoincrement())
  projectId          Int                       @unique
  targetProgramStart DateTime?
  targetProgramEnd   DateTime?
  plannedProgress    Decimal?
  actualProgress     Decimal?
  variance           Decimal?
  eotStart           DateTime?
  eotEnd             DateTime?
  eotDays            Int?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  controlMilestones  ProjectControlMilestone[]
  project            Project                   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_planning")
}

model ProjectCommercial {
  id                            Int      @id @default(autoincrement())
  projectId                     Int      @unique
  contractValue                 Decimal?
  provisionalSum                Decimal?
  instructedProvisionalSum      Decimal?
  variations                    Decimal?
  omission                      Decimal?
  dayworks                      Decimal?
  preliminaries                 Decimal?
  subContractors                Decimal?
  suppliersMaterial             Decimal?
  machinery                     Decimal?
  labors                        Decimal?
  vat                           Decimal?
  prolongationCostExpectedValue Decimal?
  budgetUpToDate                Decimal?
  totalActualCostToDate         Decimal?
  forecastedBudgetAtCompletion  Decimal?
  forecastedCostAtCompletion    Decimal?
  overallStatus                 String?
  projectProgressPercentage     Decimal?
  projectRevenuePercentage      Decimal?
  projectCostPercentage         Decimal?
  createdAt                     DateTime @default(now())
  updatedAt                     DateTime @updatedAt
  project                       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_commercial")
}

model ProjectCommercialChecklistItem {
  id            Int      @id @default(autoincrement())
  projectId     Int
  checkListItem String
  yesNo         String?
  status        String?
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  project       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([sortOrder])
  @@map("project_commercial_checklist_items")
}

model ProjectControlMilestone {
  id              Int              @id @default(autoincrement())
  projectId       Int
  planningId      Int?
  name            String
  startDate       DateTime?
  endDate         DateTime?
  actualStartDate DateTime?
  actualEndDate   DateTime?
  status          String           @default("Pending")
  sortOrder       Int              @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  planning        ProjectPlanning? @relation(fields: [planningId], references: [id])
  project         Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([planningId])
  @@map("project_control_milestones")
}

model ProjectQualityE1Log {
  id                Int      @id @default(autoincrement())
  projectId         Int
  submissionType    String
  totalNumber       Int?
  submitted         Int?
  underReview       Int?
  approved          Int?
  reviseAndResubmit Int?
  sortOrder         Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  project           Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, submissionType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_quality_e1_logs")
}

model ProjectQualityE2Log {
  id                Int      @id @default(autoincrement())
  projectId         Int
  submissionType    String
  totalNumber       Int?
  submitted         Int?
  underReview       Int?
  approved          Int?
  reviseAndResubmit Int?
  sortOrder         Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  project           Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, submissionType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_quality_e2_logs")
}

model ProjectQualityChecklistEntry {
  id             Int      @id @default(autoincrement())
  projectId      Int
  submissionType String
  submitted      Int?
  approved       Int?
  underReview    Int?
  rejected       Int?
  sortOrder      Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, submissionType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_quality_checklist_entries")
}

model ProjectIPC {
  id                     Int       @id @default(autoincrement())
  projectId              Int
  paymentType            String?
  invoiceNumber          String
  month                  String?
  grossValueSubmitted    Decimal?
  dateSubmitted          DateTime?
  grossValueCertified    Decimal?
  certifiedDate          DateTime?
  paymentDueDate         DateTime?
  advancePaymentRecovery Decimal?
  retention              Decimal?
  contraCharges          Decimal?
  netCertifiedPayable    Decimal?
  vat5Percent            Decimal?
  netPayable             Decimal?
  paymentStatus          String?
  receivedPayment        Decimal?
  paymentReceivedDate    DateTime?
  inProcess              Decimal?
  dueDays                Int?
  overDueAmount          Decimal?
  remarks                String?
  sortOrder              Int       @default(0)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  project                Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, invoiceNumber])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_ipc")
}

model ProjectChecklistItem {
  id           Int       @id @default(autoincrement())
  projectId    Int
  itemNumber   String
  phase        String
  plannedDate  DateTime?
  actualDate   DateTime?
  status       String?
  notes        String?
  isSubItem    Boolean   @default(false)
  parentItemId Int?
  order        Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  project      Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_checklist_items")
}

model ProjectPosition {
  id                  Int            @id @default(autoincrement())
  projectId           Int
  designation         String
  requiredUtilization Int            @default(100)
  startDate           DateTime?
  endDate             DateTime?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  project             Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  staffAssignments    ProjectStaff[]

  @@unique([projectId, designation])
  @@map("project_positions")
}

model ProjectStaff {
  id              Int                    @id @default(autoincrement())
  projectId       Int
  positionId      Int
  staffId         Int?
  utilization     Int                    @default(100)
  startDate       DateTime?
  endDate         DateTime?
  status          String                 @default("Active")
  notes           String?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  position        ProjectPosition        @relation(fields: [positionId], references: [id], onDelete: Cascade)
  project         Project                @relation(fields: [projectId], references: [id], onDelete: Cascade)
  staff           CompanyStaff?          @relation(fields: [staffId], references: [id], onDelete: Cascade)
  movementHistory StaffMovementHistory[] @relation("ProjectStaffHistory")

  @@unique([projectId, staffId])
  @@map("project_staff")
}

model StaffMovementHistory {
  id               Int           @id @default(autoincrement())
  staffId          Int
  type             String        @default("movement")
  fromProjectId    Int?
  fromProjectName  String?
  fromPositionId   Int?
  fromPositionName String?
  toProjectId      Int
  toProjectName    String
  toPositionId     Int
  toPositionName   String
  movedBy          String?
  movementDate     DateTime      @default(now())
  notes            String?
  createdAt        DateTime      @default(now())
  projectStaffId   Int?
  projectStaff     ProjectStaff? @relation("ProjectStaffHistory", fields: [projectStaffId], references: [id])
  staff            CompanyStaff  @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([toProjectId])
  @@map("staff_movement_history")
}

model ChecklistTemplate {
  id          Int      @id @default(autoincrement())
  name        String   @default("Default Template")
  description String?
  items       Json
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("checklist_templates")
}

model Position {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  monthlyRate Float?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("positions")
}

model Trade {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  monthlyRate Float?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("trades")
}

model Labour {
  id                Int                     @id @default(autoincrement())
  tenantId          Int                     @default(1)
  labourName        String
  employeeNumber    String?
  phone             String?
  trade             String?
  isActive          Boolean                 @default(true)
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  vacationStartDate DateTime?
  vacationEndDate   DateTime?
  monthlyBaseRate   Decimal?
  movementHistory   LabourMovementHistory[] @relation("LabourHistory")
  tenant            Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  leaveHistory      LeaveHistory[]          @relation("LabourLeaveHistory")
  projectLabours    ProjectLabour[]

  @@index([tenantId])
  @@map("labours")
}

model ProjectTrade {
  id                Int             @id @default(autoincrement())
  projectId         Int
  trade             String
  requiredQuantity  Int             @default(1)
  startDate         DateTime?
  endDate           DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  labourAssignments ProjectLabour[]
  project           Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, trade])
  @@map("project_trades")
}

model ProjectLabour {
  id              Int                     @id @default(autoincrement())
  projectId       Int
  tradeId         Int
  labourId        Int?
  utilization     Int                     @default(100)
  startDate       DateTime?
  endDate         DateTime?
  status          String                  @default("Active")
  notes           String?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  movementHistory LabourMovementHistory[] @relation("ProjectLabourHistory")
  labour          Labour?                 @relation(fields: [labourId], references: [id], onDelete: Cascade)
  project         Project                 @relation(fields: [projectId], references: [id], onDelete: Cascade)
  trade           ProjectTrade            @relation(fields: [tradeId], references: [id], onDelete: Cascade)

  @@unique([projectId, labourId])
  @@map("project_labours")
}

model Plant {
  id               Int            @id @default(autoincrement())
  tenantId         Int            @default(1)
  plantDescription String
  plantCode        String
  plateNumber      String?
  plantType        String         @default("direct")
  isOwned          Boolean        @default(false)
  monthlyCost      Float
  isActive         Boolean        @default(true)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  tenant           Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectPlants    ProjectPlant[]

  @@unique([tenantId, plantCode])
  @@index([tenantId])
  @@map("plants")
}

model ProjectPlantRequirement {
  id               Int                           @id @default(autoincrement())
  projectId        Int
  title            String
  description      String?
  requiredQuantity Int                           @default(1)
  notes            String?
  plannedStartDate DateTime?
  plannedEndDate   DateTime?
  monthlyBudget    Float?
  useSlotDates     Boolean                       @default(false)
  createdAt        DateTime                      @default(now())
  updatedAt        DateTime                      @updatedAt
  slots            ProjectPlantRequirementSlot[]
  project          Project                       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignments      ProjectPlant[]

  @@index([projectId])
  @@map("project_plant_requirements")
}

model ProjectPlant {
  id            Int                      @id @default(autoincrement())
  projectId     Int
  plantId       Int?
  requirementId Int?
  slotIndex     Int?
  startDate     DateTime?
  endDate       DateTime?
  status        String                   @default("Active")
  notes         String?
  monthlyCost   Float?
  createdAt     DateTime                 @default(now())
  updatedAt     DateTime                 @updatedAt
  plant         Plant?                   @relation(fields: [plantId], references: [id])
  project       Project                  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  requirement   ProjectPlantRequirement? @relation(fields: [requirementId], references: [id])

  @@index([projectId])
  @@index([plantId])
  @@index([requirementId])
  @@map("project_plants")
}

model ProjectPlantRequirementSlot {
  id               Int                     @id @default(autoincrement())
  requirementId    Int
  slotIndex        Int
  startDate        DateTime?
  endDate          DateTime?
  plannedStartDate DateTime?
  plannedEndDate   DateTime?
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  requirement      ProjectPlantRequirement @relation(fields: [requirementId], references: [id], onDelete: Cascade)

  @@unique([requirementId, slotIndex])
  @@index([requirementId])
  @@map("project_plant_requirement_slots")
}

model LabourMovementHistory {
  id              Int            @id @default(autoincrement())
  labourId        Int
  type            String         @default("movement")
  fromProjectId   Int?
  fromProjectName String?
  fromTradeId     Int?
  fromTradeName   String?
  toProjectId     Int
  toProjectName   String
  toTradeId       Int
  toTradeName     String
  movedBy         String?
  movementDate    DateTime       @default(now())
  notes           String?
  createdAt       DateTime       @default(now())
  projectLabourId Int?
  labour          Labour         @relation("LabourHistory", fields: [labourId], references: [id], onDelete: Cascade)
  projectLabour   ProjectLabour? @relation("ProjectLabourHistory", fields: [projectLabourId], references: [id])

  @@index([labourId])
  @@index([toProjectId])
  @@map("labour_movement_history")
}

model LeaveHistory {
  id             Int           @id @default(autoincrement())
  entityType     String
  staffId        Int?
  labourId       Int?
  leaveStartDate DateTime
  leaveEndDate   DateTime
  returnDate     DateTime?
  isReturned     Boolean       @default(false)
  notes          String?
  createdBy      String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  labour         Labour?       @relation("LabourLeaveHistory", fields: [labourId], references: [id], onDelete: Cascade)
  staff          CompanyStaff? @relation("StaffLeaveHistory", fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([labourId])
  @@index([entityType])
  @@index([leaveStartDate])
  @@index([leaveEndDate])
  @@map("leave_history")
}

model ProjectLabourSupply {
  id             Int       @id @default(autoincrement())
  projectId      Int
  trade          String
  numberOfLabour Int
  pricePerHour   Decimal
  startDate      DateTime?
  endDate        DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, trade])
  @@index([projectId])
  @@map("project_labour_supplies")
}

model ProjectHseChecklistItem {
  id          Int       @id @default(autoincrement())
  projectId   Int
  item        String
  plannedDate DateTime?
  actualDate  DateTime?
  status      String?
  notes       String?
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_hse_checklist_items")
}

model ProjectNocTrackerEntry {
  id                    Int       @id @default(autoincrement())
  projectId             Int
  nocNumber             String?
  permitType            String?
  plannedSubmissionDate DateTime?
  actualSubmissionDate  DateTime?
  status                String?
  expiryDate            DateTime?
  remarks               String?
  sortOrder             Int       @default(0)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  project               Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_noc_tracker_entries")
}

model ProjectRiskEntry {
  id        Int      @id @default(autoincrement())
  projectId Int
  riskItem  String
  impact    String?
  remarks   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_risk_entries")
}

model TypeOfWork {
  id                  Int                  @id @default(autoincrement())
  name                String               @unique
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  supplierAssignments SupplierTypeOfWork[]

  @@map("type_of_works")
}

model Supplier {
  id                    Int                       @id @default(autoincrement())
  tenantId              Int                       @default(1)
  name                  String
  vendorCode            String?
  type                  String
  contactPerson         String?
  contactNumber         String?
  email                 String?
  contractValueCapability Decimal?
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  projectSubcontractors ProjectSubcontractor[]
  projectSuppliers      ProjectSupplier[]
  projectEvaluations    ProjectVendorEvaluation[]
  typeOfWorks           SupplierTypeOfWork[]
  tenant                Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("suppliers")
}

model SupplierTypeOfWork {
  supplierId   Int
  typeOfWorkId Int
  assignedAt   DateTime   @default(now())
  supplier     Supplier   @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  typeOfWork   TypeOfWork @relation(fields: [typeOfWorkId], references: [id], onDelete: Cascade)

  @@id([supplierId, typeOfWorkId])
  @@map("supplier_type_of_work")
}

model ProjectVendorEvaluation {
  id         Int      @id @default(autoincrement())
  projectId  Int
  supplierId Int
  rating     String
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  supplier   Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@unique([projectId, supplierId])
  @@map("project_vendor_evaluations")
}

model ProjectSupplier {
  id                Int                      @id @default(autoincrement())
  projectId         Int
  supplierId        Int
  notes             String?
  performanceRating Int?
  performanceReview String?
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  grns              ProjectGRN[]
  invoices          ProjectInvoice[]
  purchaseOrders    ProjectPurchaseOrder[]
  payments          ProjectSupplierPayment[]
  project           Project                  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  supplier          Supplier                 @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@unique([projectId, supplierId])
  @@map("project_suppliers")
}

model ProjectPurchaseOrder {
  id                Int              @id @default(autoincrement())
  projectId         Int
  projectSupplierId Int
  lpoNumber         String
  lpoDate           DateTime
  lpoValue          Decimal
  vatPercent        Decimal          @default(5.0)
  lpoValueWithVat   Decimal
  notes             String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  grns              ProjectGRN[]
  invoices          ProjectInvoice[]
  project           Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSupplier   ProjectSupplier  @relation(fields: [projectSupplierId], references: [id], onDelete: Cascade)

  @@unique([projectId, projectSupplierId, lpoNumber])
  @@index([projectId])
  @@index([projectSupplierId])
  @@map("project_purchase_orders")
}

model ProjectGRN {
  id                Int                  @id @default(autoincrement())
  projectId         Int
  projectSupplierId Int
  purchaseOrderId   Int
  grnRefNo          String
  grnDate           DateTime
  deliveredAmount   Decimal
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  invoiceGRNs       InvoiceGRN[]
  project           Project              @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSupplier   ProjectSupplier      @relation(fields: [projectSupplierId], references: [id], onDelete: Cascade)
  purchaseOrder     ProjectPurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectSupplierId])
  @@index([purchaseOrderId])
  @@map("project_grns")
}

model ProjectInvoice {
  id                  Int                   @id @default(autoincrement())
  projectId           Int
  projectSupplierId   Int
  purchaseOrderId     Int?
  invoiceNumber       String
  invoiceDate         DateTime
  dueDate             DateTime?
  paymentType         String
  downPayment         Decimal?
  invoiceAmount       Decimal
  vatAmount           Decimal
  downPaymentRecovery Decimal?
  totalAmount         Decimal
  status              String                @default("unpaid")
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  invoiceGRNs         InvoiceGRN[]
  paymentInvoices     PaymentInvoice[]
  project             Project               @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSupplier     ProjectSupplier       @relation(fields: [projectSupplierId], references: [id], onDelete: Cascade)
  purchaseOrder       ProjectPurchaseOrder? @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@unique([projectId, projectSupplierId, invoiceNumber])
  @@index([projectId])
  @@index([projectSupplierId])
  @@index([purchaseOrderId])
  @@map("project_invoices")
}

model ProjectSupplierPayment {
  id                 Int              @id @default(autoincrement())
  projectId          Int
  projectSupplierId  Int
  paymentMethod      String
  paymentType        String?
  paymentDate        DateTime
  dueDate            DateTime?
  totalPaymentAmount Decimal
  totalVatAmount     Decimal
  liquidated         Boolean          @default(false)
  notes              String?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  paymentInvoices    PaymentInvoice[]
  project            Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSupplier    ProjectSupplier  @relation(fields: [projectSupplierId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectSupplierId])
  @@map("project_supplier_payments")
}

model PaymentInvoice {
  id            Int                    @id @default(autoincrement())
  paymentId     Int
  invoiceId     Int
  paymentAmount Decimal
  vatAmount     Decimal
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  invoice       ProjectInvoice         @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  payment       ProjectSupplierPayment @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@unique([paymentId, invoiceId])
  @@index([paymentId])
  @@index([invoiceId])
  @@map("payment_invoices")
}

model InvoiceGRN {
  id        Int            @id @default(autoincrement())
  invoiceId Int
  grnId     Int
  createdAt DateTime       @default(now())
  grn       ProjectGRN     @relation(fields: [grnId], references: [id], onDelete: Cascade)
  invoice   ProjectInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@unique([invoiceId, grnId])
  @@index([invoiceId])
  @@index([grnId])
  @@map("invoice_grns")
}

model ProjectSubcontractor {
  id                              Int                                 @id @default(autoincrement())
  projectId                       Int
  subcontractorId                 Int
  scopeOfWork                     String?
  subcontractAgreement            Boolean                             @default(false)
  subcontractAgreementDocumentUrl String?
  performanceRating               Int?
  performanceReview               String?
  createdAt                       DateTime                            @default(now())
  updatedAt                       DateTime                            @updatedAt
  changeOrders                    ProjectSubcontractorChangeOrder[]
  invoices                        ProjectSubcontractorInvoice[]
  payments                        ProjectSubcontractorPayment[]
  purchaseOrders                  ProjectSubcontractorPurchaseOrder[]
  project                         Project                             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  subcontractor                   Supplier                            @relation(fields: [subcontractorId], references: [id], onDelete: Cascade)

  @@unique([projectId, subcontractorId])
  @@map("project_subcontractors")
}

model ProjectSubcontractorPurchaseOrder {
  id                     Int                               @id @default(autoincrement())
  projectId              Int
  projectSubcontractorId Int
  lpoNumber              String
  lpoDate                DateTime
  lpoValue               Decimal
  vatPercent             Decimal                           @default(5.0)
  lpoValueWithVat        Decimal
  notes                  String?
  createdAt              DateTime                          @default(now())
  updatedAt              DateTime                          @updatedAt
  changeOrders           ProjectSubcontractorChangeOrder[]
  invoices               ProjectSubcontractorInvoice[]
  project                Project                           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSubcontractor   ProjectSubcontractor              @relation(fields: [projectSubcontractorId], references: [id], onDelete: Cascade)

  @@unique([projectId, projectSubcontractorId, lpoNumber])
  @@index([projectId])
  @@index([projectSubcontractorId])
  @@map("project_subcontractor_purchase_orders")
}

model ProjectSubcontractorChangeOrder {
  id                     Int                                      @id @default(autoincrement())
  projectId              Int
  projectSubcontractorId Int
  purchaseOrderId        Int
  chRefNo                String
  chDate                 DateTime
  type                   String
  amount                 Decimal
  vatPercent             Decimal                                  @default(5.0)
  vatAmount              Decimal                                  @default(0)
  amountWithVat          Decimal                                  @default(0)
  description            String?
  createdAt              DateTime                                 @default(now())
  updatedAt              DateTime                                 @updatedAt
  project                Project                                  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSubcontractor   ProjectSubcontractor                     @relation(fields: [projectSubcontractorId], references: [id], onDelete: Cascade)
  purchaseOrder          ProjectSubcontractorPurchaseOrder        @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  invoiceChangeOrders    ProjectSubcontractorInvoiceChangeOrder[]
  advancePaymentInvoices ProjectSubcontractorInvoice[]            @relation("ChangeOrderAdvancePayment")

  @@index([projectId])
  @@index([projectSubcontractorId])
  @@index([purchaseOrderId])
  @@map("project_subcontractor_change_orders")
}

model ProjectSubcontractorInvoice {
  id                       Int                                      @id @default(autoincrement())
  projectId                Int
  projectSubcontractorId   Int
  purchaseOrderId          Int?
  changeOrderId            Int?
  invoiceNumber            String
  invoiceDate              DateTime
  dueDate                  DateTime?
  paymentType              String
  downPayment              Decimal?
  invoiceAmount            Decimal
  vatAmount                Decimal
  downPaymentRecovery      Decimal?
  advanceRecovery          Decimal?
  retention                Decimal?
  contraChargesAmount      Decimal?
  contraChargesDescription String?
  totalAmount              Decimal
  status                   String                                   @default("unpaid")
  createdAt                DateTime                                 @default(now())
  updatedAt                DateTime                                 @updatedAt
  invoiceChangeOrders      ProjectSubcontractorInvoiceChangeOrder[]
  changeOrder              ProjectSubcontractorChangeOrder?         @relation("ChangeOrderAdvancePayment", fields: [changeOrderId], references: [id], onDelete: Cascade)
  project                  Project                                  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSubcontractor     ProjectSubcontractor                     @relation(fields: [projectSubcontractorId], references: [id], onDelete: Cascade)
  purchaseOrder            ProjectSubcontractorPurchaseOrder?       @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  paymentInvoices          ProjectSubcontractorPaymentInvoice[]

  @@unique([projectId, projectSubcontractorId, invoiceNumber])
  @@index([projectId])
  @@index([projectSubcontractorId])
  @@index([purchaseOrderId])
  @@index([changeOrderId])
  @@map("project_subcontractor_invoices")
}

model ProjectSubcontractorPayment {
  id                     Int                                  @id @default(autoincrement())
  projectId              Int
  projectSubcontractorId Int
  paymentMethod          String
  paymentType            String?
  paymentDate            DateTime
  dueDate                DateTime?
  totalPaymentAmount     Decimal
  totalVatAmount         Decimal
  liquidated             Boolean                              @default(false)
  notes                  String?
  createdAt              DateTime                             @default(now())
  updatedAt              DateTime                             @updatedAt
  paymentInvoices        ProjectSubcontractorPaymentInvoice[]
  project                Project                              @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectSubcontractor   ProjectSubcontractor                 @relation(fields: [projectSubcontractorId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectSubcontractorId])
  @@map("project_subcontractor_payments")
}

model ProjectSubcontractorPaymentInvoice {
  id            Int                         @id @default(autoincrement())
  paymentId     Int
  invoiceId     Int
  paymentAmount Decimal
  vatAmount     Decimal
  createdAt     DateTime                    @default(now())
  updatedAt     DateTime                    @updatedAt
  invoice       ProjectSubcontractorInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  payment       ProjectSubcontractorPayment @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@unique([paymentId, invoiceId])
  @@index([paymentId])
  @@index([invoiceId])
  @@map("project_subcontractor_payment_invoices")
}

model ProjectSubcontractorInvoiceChangeOrder {
  id            Int                             @id @default(autoincrement())
  invoiceId     Int
  changeOrderId Int
  createdAt     DateTime                        @default(now())
  changeOrder   ProjectSubcontractorChangeOrder @relation(fields: [changeOrderId], references: [id], onDelete: Cascade)
  invoice       ProjectSubcontractorInvoice     @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@unique([invoiceId, changeOrderId])
  @@index([invoiceId])
  @@index([changeOrderId])
  @@map("project_subcontractor_invoice_change_orders")
}

model ProjectAreaOfConcern {
  id             Int       @id @default(autoincrement())
  projectId      Int
  description    String
  actionNeeded   String?
  startedDate    DateTime?
  resolutionDate DateTime?
  status         String    @default("Ongoing")
  remarks        String?
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_area_of_concerns")
}

model ProjectClientFeedback {
  id             Int      @id @default(autoincrement())
  projectId      Int      @unique
  rating         String?
  positivePoints Json?
  negativePoints Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_client_feedback")
}

model ProjectAsset {
  id          Int      @id @default(autoincrement())
  projectId   Int
  type        String
  description String
  assetNumber String?
  status      String   @default("Active")
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_assets")
}

model ProjectPicture {
  id         Int          @id @default(autoincrement())
  projectId  Int
  mediaId    Int
  caption    String?
  sortOrder  Int          @default(0)
  isFeatured Boolean      @default(false)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  media      MediaLibrary @relation(fields: [mediaId], references: [id], onDelete: Cascade)
  project    Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([mediaId])
  @@index([projectId, isFeatured])
  @@map("project_pictures")
}

model ProjectCloseOutEntry {
  id            Int      @id @default(autoincrement())
  projectId     Int
  itemType      String
  totalRequired Int?
  submitted     Int?
  approved      Int?
  underReview   Int?
  rejected      Int?
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  project       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, itemType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_close_out_entries")
}

model ConsultantToConsultantType {
  A                Int
  B                Int
  consultants      Consultant     @relation(fields: [A], references: [id], onDelete: Cascade)
  consultant_types ConsultantType @relation(fields: [B], references: [id], onDelete: Cascade)

  @@unique([A, B], map: "_ConsultantToConsultantType_AB_unique")
  @@index([B], map: "_ConsultantToConsultantType_B_index")
  @@map("_ConsultantToConsultantType")
}

model ProjectReport {
  id          Int       @id @default(autoincrement())
  projectId   Int
  userId      Int
  reportMonth Int
  reportYear  Int
  reportData  Json
  shareToken  String?  @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user        AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, reportMonth, reportYear])
  @@index([projectId])
  @@index([userId])
  @@index([reportYear, reportMonth])
  @@index([shareToken])
  @@map("project_reports")
}
