generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model SiteSettings {
  id                       Int      @id @default(autoincrement())
  logoUrl                  String?
  logoLightUrl             String?
  logoDarkUrl              String?
  faviconUrl               String?
  faviconLightUrl          String?
  faviconDarkUrl           String?
  smtpEnabled              Boolean  @default(false)
  smtpHost                 String?
  smtpPort                 Int?     @default(587)
  smtpSecure               Boolean  @default(true)
  smtpUsername             String?
  smtpPassword             String?
  smtpFromEmail            String?
  smtpFromName             String?
  smtpReplyTo              String?
  emailSignature           String?
  emailFooterText          String?
  emailBrandingEnabled     Boolean  @default(true)
  adminNotificationEmail   String?
  emailLoggingEnabled      Boolean  @default(true)
  emailRateLimitPerHour    Int?     @default(100)
  companyPhone             String?
  companyEmail             String?
  companyAddress           String?
  socialFacebook           String?
  socialTwitter            String?
  socialLinkedin           String?
  socialInstagram          String?
  socialYoutube            String?
  footerNewsletterFormId   Int?
  footerCopyrightMessage   String?
  footerMenuIds            String?
  footerShowContactInfo    Boolean  @default(true)
  footerShowSocialLinks    Boolean  @default(true)
  footerCompanyName        String?
  footerCompanyDescription String?
  footerBackgroundColor    String?  @default("#F9FAFB")
  footerTextColor          String?  @default("#374151")
  baseUrl                  String?  @default("")
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  gaMeasurementId          String?  @default("NULL")
  gtmContainerId           String?  @default("NULL")
  gtmEnabled               Boolean  @default(false)
  cloudinaryApiKey         String?
  cloudinaryApiSecret      String?
  cloudinaryCloudName      String?
  cloudinaryEnabled        Boolean  @default(false)
  cloudinaryUploadPreset   String?
  sidebarBackgroundColor   String?  @default("#1F2937")
  sidebarHoverColor        String?  @default("#D1D5DB")
  sidebarSelectedColor     String?  @default("#FFFFFF")
  sidebarTextColor         String?  @default("#E5E7EB")
  currencySymbol           String?  @default("$")

  @@map("site_settings")
}

model ServiceAccountCredentials {
  id                      Int      @id @default(autoincrement())
  projectId               String
  clientEmail             String
  privateKey              String
  privateKeyId            String
  clientId                String
  authUri                 String
  tokenUri                String
  authProviderX509CertUrl String
  clientX509CertUrl       String
  universeDomain          String
  isActive                Boolean  @default(true)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @default(now()) @updatedAt

  @@map("service_account_credentials")
}

model SitemapSubmissionLog {
  id             String   @id @default(cuid())
  sitemapUrl     String
  siteUrl        String
  submittedAt    DateTime @default(now())
  status         String
  searchEngine   String
  googleResponse String?
  errorMessage   String?
  statusCode     Int?
  submissionId   String?
  warnings       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @default(now()) @updatedAt

  @@map("sitemap_submission_logs")
}

model DesignSystem {
  id                           Int      @id @default(autoincrement())
  primaryColor                 String   @default("#EF2908")
  primaryColorLight            String   @default("#FF4013")
  primaryColorDark             String   @default("#C71508")
  secondaryColor               String   @default("#FFFFFF")
  accentColor                  String   @default("#06B6D4")
  successColor                 String   @default("#10B981")
  warningColor                 String   @default("#F59E0B")
  errorColor                   String   @default("#EF4444")
  infoColor                    String   @default("#3B82F6")
  borderLight                  String   @default("#EBEBEB")
  borderStrong                 String   @default("#D6D6D6")
  backgroundPrimary            String   @default("#FFFFFF")
  backgroundSecondary          String   @default("#F5F8F8")
  backgroundDark               String   @default("#F1F1F1")
  headerBackgroundColor        String   @default("#FF2600")
  sidebarHeaderBackgroundColor String   @default("#FF2600")
  sidebarBackgroundColor       String   @default("#FFFFFF")
  textPrimary                  String   @default("#4B5563")
  textSecondary                String   @default("#9CA3AF")
  textMuted                    String   @default("#AAAAAA")
  headerTextColor              String   @default("#FFFFFF")
  sidebarTextColor             String   @default("#000000")
  sidebarHeaderColor           String   @default("#FFFFFF")
  fontFamily                   String   @default("Manrope")
  fontFamilyMono               String   @default("ui-monospace")
  fontSizeBase                 String   @default("16px")
  lineHeightBase               String   @default("1.5")
  fontWeightNormal             String   @default("400")
  fontWeightMedium             String   @default("500")
  fontWeightBold               String   @default("700")
  spacingXs                    String   @default("4px")
  spacingSm                    String   @default("8px")
  spacingMd                    String   @default("16px")
  spacingLg                    String   @default("24px")
  spacingXl                    String   @default("32px")
  spacing2xl                   String   @default("48px")
  borderRadiusSm               String   @default("4px")
  borderRadiusMd               String   @default("8px")
  borderRadiusLg               String   @default("12px")
  borderRadiusXl               String   @default("16px")
  borderRadiusFull             String   @default("9999px")
  shadowSm                     String   @default("0 1px 2px 0 rgb(0 0 0 / 0.05)")
  shadowMd                     String   @default("0 4px 6px -1px rgb(0 0 0 / 0.1)")
  shadowLg                     String   @default("0 10px 15px -3px rgb(0 0 0 / 0.1)")
  shadowXl                     String   @default("0 20px 25px -5px rgb(0 0 0 / 0.1)")
  animationFast                String   @default("150ms")
  animationNormal              String   @default("300ms")
  animationSlow                String   @default("500ms")
  breakpointSm                 String   @default("640px")
  breakpointMd                 String   @default("768px")
  breakpointLg                 String   @default("1024px")
  breakpointXl                 String   @default("1280px")
  breakpoint2xl                String   @default("1536px")
  themeMode                    String   @default("light")
  customVariables              String?
  isActive                     Boolean  @default(true)
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt

  @@map("design_system")
}

model MediaLibrary {
  id           Int          @id @default(autoincrement())
  filename     String
  title        String?
  description  String?
  alt          String?
  fileType     String
  mimeType     String
  fileSize     Int
  width        Int?
  height       Int?
  duration     Float?
  originalUrl  String
  localPath    String?
  publicUrl    String
  thumbnailUrl String?
  folderId     Int?
  tags         String?
  uploadSource String       @default("upload")
  uploadedBy   String?
  isActive     Boolean      @default(true)
  isPublic     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  folder       MediaFolder? @relation(fields: [folderId], references: [id])
  usages       MediaUsage[]
  projectPictures ProjectPicture[]

  @@map("media_library")
}

model MediaFolder {
  id          Int            @id @default(autoincrement())
  name        String
  description String?
  parentId    Int?
  color       String         @default("#5243E9")
  sortOrder   Int            @default(0)
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  parent      MediaFolder?   @relation("FolderHierarchy", fields: [parentId], references: [id])
  children    MediaFolder[]  @relation("FolderHierarchy")
  media       MediaLibrary[]

  @@map("media_folders")
}

model MediaUsage {
  id         Int          @id @default(autoincrement())
  mediaId    Int
  entityType String
  entityId   Int
  fieldName  String
  createdAt  DateTime     @default(now())
  media      MediaLibrary @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@unique([mediaId, entityType, entityId, fieldName])
  @@map("media_usage")
}

model Tenant {
  id          Int       @id @default(autoincrement())
  name        String
  slug        String    @unique
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  users       AdminUser[]
  roles       Role[]
  permissions Permission[]
  projects    Project[]
  clients     Client[]
  consultants Consultant[]
  staff       CompanyStaff[]
  labours     Labour[]
  plants      Plant[]
  auditLogs   AuditLog[]
  suppliers   Supplier[]

  @@index([slug])
  @@map("tenants")
}

model AdminUser {
  id                  Int       @id @default(autoincrement())
  tenantId            Int       @default(1) // Default tenant for migration
  username            String
  email               String
  passwordHash        String
  name                String?
  role                String    @default("admin") // Legacy field, keep for backward compatibility
  isActive            Boolean   @default(true)
  hasAllProjectsAccess Boolean  @default(false) // If true, user can access all projects regardless of memberships
  lastLoginAt         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  userRoles           UserRole[]
  projectMemberships  ProjectMembership[]
  projectReports      ProjectReport[]

  @@unique([tenantId, username])
  @@unique([tenantId, email])
  @@index([tenantId])
  @@map("admin_users")
}

model Permission {
  id          Int      @id @default(autoincrement())
  tenantId    Int      @default(1) // Permissions are tenant-scoped but can share keys
  key         String   // e.g., "project.view_basic", "staff.assign_to_project"
  resource    String   // e.g., "project", "staff", "labour", "admin"
  description String?
  isSystem    Boolean  @default(false) // System permissions cannot be deleted
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rolePermissions RolePermission[]

  @@unique([tenantId, key])
  @@index([tenantId])
  @@index([resource])
  @@map("permissions")
}

model Role {
  id          Int      @id @default(autoincrement())
  tenantId    Int
  name        String
  description String?
  isSystem    Boolean  @default(false) // System roles cannot be deleted
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rolePermissions RolePermission[]
  userRoles   UserRole[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("roles")
}

model RolePermission {
  id           Int        @id @default(autoincrement())
  roleId       Int
  permissionId Int
  action       String     @default("allow") // "allow" or "deny" - deny wins
  createdAt    DateTime   @default(now())
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@map("role_permissions")
}

model UserRole {
  id        Int      @id @default(autoincrement())
  userId    Int
  roleId    Int
  createdAt DateTime @default(now())
  user      AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@map("user_roles")
}

model ProjectMembership {
  id        Int      @id @default(autoincrement())
  userId    Int
  projectId Int
  createdAt DateTime @default(now())
  user      AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([userId, projectId])
  @@index([userId])
  @@index([projectId])
  @@map("project_memberships")
}

model AuditLog {
  id          Int      @id @default(autoincrement())
  tenantId    Int
  userId      Int?
  action      String   // e.g., "staff.move", "project.create", "permission.denied"
  resource    String   // e.g., "staff", "project"
  resourceId  Int?
  details     Json?    // Additional context
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([userId])
  @@index([action])
  @@index([resource, resourceId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Client {
  id            Int       @id @default(autoincrement())
  tenantId      Int       @default(1)
  name          String
  officeAddress String?
  phone         String?
  email         String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projects      Project[]

  @@index([tenantId])
  @@map("clients")
}

model Consultant {
  id                         Int                          @id @default(autoincrement())
  tenantId                   Int                          @default(1)
  name                       String
  officeAddress              String?
  phone                      String?
  email                      String?
  isActive                   Boolean                      @default(true)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  tenant                     Tenant                        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ConsultantToConsultantType ConsultantToConsultantType[]
  projectsAsCost             Project[]                    @relation("CostConsultant")
  projectsAsSupervision      Project[]                    @relation("SupervisionConsultant")
  projectsAsDesign           Project[]                    @relation("DesignConsultant")
  projectsAsPMC              Project[]                    @relation("ProjectManagementConsultant")

  @@index([tenantId])
  @@map("consultants")
}

model ConsultantType {
  id                         Int                          @id @default(autoincrement())
  type                       String                       @unique
  description                String?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  ConsultantToConsultantType ConsultantToConsultantType[]

  @@map("consultant_types")
}

model CompanyStaff {
  id                 Int                    @id @default(autoincrement())
  tenantId           Int                    @default(1)
  staffName          String
  email              String?
  phone              String?
  position           String?
  isActive           Boolean                @default(true)
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  employeeNumber     String?
  vacationStartDate  DateTime?
  vacationEndDate    DateTime?
  monthlyBaseRate    Decimal?
  tenant             Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectStaff       ProjectStaff[]
  projectsAsManager  Project[]              @relation("ProjectManager")
  projectsAsDirector Project[]              @relation("ProjectDirector")
  movementHistory    StaffMovementHistory[]
  leaveHistory       LeaveHistory[]         @relation("StaffLeaveHistory")

  @@index([tenantId])
  @@map("company_staff")
}

model Contact {
  id              Int              @id @default(autoincrement())
  firstName       String
  lastName        String
  email           String?
  phone           String?
  position        String?
  notes           String?
  isActive        Boolean          @default(true)
  entityType      String
  entityId        Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  projectContacts ProjectContact[]

  @@map("contacts")
}

model ProjectContact {
  id             Int      @id @default(autoincrement())
  projectId      Int
  contactId      Int
  isPrimary      Boolean  @default(false)
  consultantType String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  contact        Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, contactId, consultantType])
  @@map("project_contacts")
}

model Project {
  id                            Int                    @id @default(autoincrement())
  tenantId                      Int                    @default(1)
  projectCode                   String
  projectName                   String
  projectDescription            String?
  clientId                      Int?
  projectManagementConsultantId Int?
  designConsultantId            Int?
  supervisionConsultantId       Int?
  costConsultantId              Int?
  projectDirectorId             Int?
  projectManagerId              Int?
  startDate                     DateTime
  endDate                       DateTime
  duration                      String?
  eot                           String?
  projectValue                  Decimal
  // IPC Settings
  advancePaymentPercentage      Decimal?               // e.g., 10.0 for 10%
  retentionPercentage           Decimal?               // e.g., 5.0 for 5%
  paymentTermsDays              Int?                   // Payment terms in days
  lastUpdate                    DateTime               @default(now()) @updatedAt
  createdAt                     DateTime               @default(now())
  updatedAt                     DateTime               @updatedAt
  tenant                        Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectChecklistItems         ProjectChecklistItem[]
  projectContacts               ProjectContact[]
  projectPositions              ProjectPosition[]
  projectStaff                  ProjectStaff[]
  projectTrades                 ProjectTrade[]
  projectLabours                ProjectLabour[]
  projectLabourSupplies         ProjectLabourSupply[]
  plantRequirements             ProjectPlantRequirement[]
  projectPlants                  ProjectPlant[]
  projectMemberships            ProjectMembership[]
  hseChecklistItems             ProjectHseChecklistItem[]
  nocTrackerEntries             ProjectNocTrackerEntry[]
  projectRisks                  ProjectRiskEntry[]
  projectVendorEvaluations      ProjectVendorEvaluation[]
  areaOfConcerns                ProjectAreaOfConcern[]
  clientFeedback                ProjectClientFeedback?
  projectAssets                 ProjectAsset[]
  projectPictures               ProjectPicture[]
  closeOutEntries               ProjectCloseOutEntry[]
  projectManager                CompanyStaff?          @relation("ProjectManager", fields: [projectManagerId], references: [id])
  projectDirector               CompanyStaff?          @relation("ProjectDirector", fields: [projectDirectorId], references: [id])
  costConsultant                Consultant?            @relation("CostConsultant", fields: [costConsultantId], references: [id])
  supervisionConsultant         Consultant?            @relation("SupervisionConsultant", fields: [supervisionConsultantId], references: [id])
  designConsultant              Consultant?            @relation("DesignConsultant", fields: [designConsultantId], references: [id])
  projectManagementConsultant   Consultant?            @relation("ProjectManagementConsultant", fields: [projectManagementConsultantId], references: [id])
  client                        Client?                @relation(fields: [clientId], references: [id])
  projectPlanning               ProjectPlanning?
  projectCommercial             ProjectCommercial?
  projectCommercialChecklistItems ProjectCommercialChecklistItem[]
  controlMilestones             ProjectControlMilestone[]
  qualityE1Logs                 ProjectQualityE1Log[]
  qualityE2Logs                 ProjectQualityE2Log[]
  qualityChecklistEntries       ProjectQualityChecklistEntry[]
  ipcEntries                    ProjectIPC[]
  projectReports                ProjectReport[]

  @@unique([tenantId, projectCode])
  @@index([tenantId])
  @@map("projects")
}

model ProjectPlanning {
  id                    Int                         @id @default(autoincrement())
  projectId             Int                         @unique
  targetProgramStart    DateTime?
  targetProgramEnd      DateTime?
  plannedProgress       Decimal?
  actualProgress        Decimal?
  variance              Decimal?
  eotStart              DateTime?
  eotEnd                DateTime?
  eotDays               Int?
  createdAt             DateTime                    @default(now())
  updatedAt             DateTime                    @updatedAt
  project               Project                     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  controlMilestones     ProjectControlMilestone[]

  @@map("project_planning")
}

model ProjectCommercial {
  id                        Int      @id @default(autoincrement())
  projectId                 Int      @unique
  // Section 12: Total Contract Value
  contractValue             Decimal?
  provisionalSum            Decimal?
  instructedProvisionalSum  Decimal?
  variations                Decimal?
  omission                  Decimal?
  dayworks                  Decimal?
  // Section 13: Budget
  preliminaries             Decimal?
  subContractors            Decimal?
  suppliersMaterial         Decimal?
  machinery                 Decimal?
  labors                    Decimal?
  // Additional fields
  vat                       Decimal?
  prolongationCostExpectedValue Decimal?
  // Actual Up to date Results
  budgetUpToDate            Decimal?
  totalActualCostToDate     Decimal?
  // Cost at Completion
  forecastedBudgetAtCompletion Decimal?
  forecastedCostAtCompletion   Decimal?
  // Overall Status
  overallStatus             String?   // "On Budget", "Over Budget", "Under Budget"
  // Project Performance Indicators
  projectProgressPercentage Decimal?
  projectRevenuePercentage  Decimal?
  projectCostPercentage     Decimal?
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  project                   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_commercial")
}

model ProjectCommercialChecklistItem {
  id             Int       @id @default(autoincrement())
  projectId      Int
  checkListItem  String
  yesNo          String?   // 'Yes' or 'No' or null
  status         String?
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([sortOrder])
  @@map("project_commercial_checklist_items")
}

model ProjectControlMilestone {
  id          Int       @id @default(autoincrement())
  projectId   Int
  planningId  Int?
  name        String
  startDate   DateTime?
  endDate     DateTime?
  actualStartDate DateTime?
  actualEndDate   DateTime?
  status      String   @default("Pending")
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  planning    ProjectPlanning? @relation(fields: [planningId], references: [id], onDelete: SetNull)

  @@index([projectId])
  @@index([planningId])
  @@map("project_control_milestones")
}

model ProjectQualityE1Log {
  id                 Int       @id @default(autoincrement())
  projectId          Int
  submissionType     String
  totalNumber        Int?
  submitted          Int?
  underReview        Int?
  approved           Int?
  reviseAndResubmit  Int?
  sortOrder          Int       @default(0)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  project            Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, submissionType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_quality_e1_logs")
}

model ProjectQualityE2Log {
  id                 Int       @id @default(autoincrement())
  projectId          Int
  submissionType     String
  totalNumber        Int?
  submitted          Int?
  underReview        Int?
  approved           Int?
  reviseAndResubmit  Int?
  sortOrder          Int       @default(0)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  project            Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, submissionType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_quality_e2_logs")
}

model ProjectQualityChecklistEntry {
  id             Int       @id @default(autoincrement())
  projectId      Int
  submissionType String
  submitted      Int?
  approved       Int?
  underReview    Int?
  rejected       Int?
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, submissionType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_quality_checklist_entries")
}

model ProjectIPC {
  id                    Int       @id @default(autoincrement())
  projectId             Int
  invoiceNumber         String
  month                 String?
  grossValueSubmitted   Decimal?
  dateSubmitted         DateTime?
  grossValueCertified   Decimal?
  certifiedDate         DateTime?
  paymentDueDate        DateTime?
  advancePaymentRecovery Decimal?
  retention             Decimal?
  contraCharges         Decimal?
  netCertifiedPayable   Decimal?
  vat5Percent           Decimal?
  netPayable            Decimal?
  receivedPayment       Decimal?
  paymentReceivedDate   DateTime?
  inProcess             Decimal?
  dueDays               Int?
  overDueAmount         Decimal?
  remarks               String?
  sortOrder             Int       @default(0)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  project               Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, invoiceNumber])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_ipc")
}

model ProjectChecklistItem {
  id           Int       @id @default(autoincrement())
  projectId    Int
  itemNumber   String
  phase        String
  plannedDate  DateTime?
  actualDate   DateTime?
  status       String?
  notes        String?
  isSubItem    Boolean   @default(false)
  parentItemId Int?
  order        Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  project      Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_checklist_items")
}

model ProjectPosition {
  id                  Int            @id @default(autoincrement())
  projectId           Int
  designation         String
  requiredUtilization Int            @default(100)
  startDate           DateTime?
  endDate             DateTime?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  project             Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  staffAssignments    ProjectStaff[]

  @@unique([projectId, designation])
  @@map("project_positions")
}

model ProjectStaff {
  id              Int                    @id @default(autoincrement())
  projectId       Int
  positionId      Int
  staffId         Int?
  utilization     Int                    @default(100)
  startDate       DateTime?
  endDate         DateTime?
  status          String                 @default("Active")
  notes           String?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  staff           CompanyStaff?          @relation(fields: [staffId], references: [id], onDelete: Cascade)
  position        ProjectPosition        @relation(fields: [positionId], references: [id], onDelete: Cascade)
  project         Project                @relation(fields: [projectId], references: [id], onDelete: Cascade)
  movementHistory StaffMovementHistory[] @relation("ProjectStaffHistory")

  @@unique([projectId, staffId])
  @@map("project_staff")
}

model StaffMovementHistory {
  id               Int           @id @default(autoincrement())
  staffId          Int
  type             String        @default("movement") // "assignment" or "movement"
  fromProjectId    Int?
  fromProjectName  String?
  fromPositionId   Int?
  fromPositionName String?
  toProjectId      Int
  toProjectName    String
  toPositionId     Int
  toPositionName   String
  movedBy          String?
  movementDate     DateTime      @default(now())
  notes            String?
  createdAt        DateTime      @default(now())
  projectStaffId   Int?
  staff            CompanyStaff  @relation(fields: [staffId], references: [id], onDelete: Cascade)
  projectStaff     ProjectStaff? @relation("ProjectStaffHistory", fields: [projectStaffId], references: [id], onDelete: SetNull)

  @@index([staffId])
  @@index([toProjectId])
  @@map("staff_movement_history")
}

model ChecklistTemplate {
  id          Int      @id @default(autoincrement())
  name        String   @default("Default Template")
  description String?
  items       Json
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("checklist_templates")
}

model Position {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  monthlyRate Float?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("positions")
}

model Trade {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  monthlyRate Float?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("trades")
}

model Labour {
  id                Int                     @id @default(autoincrement())
  tenantId          Int                     @default(1)
  labourName        String
  employeeNumber    String?
  phone             String?
  trade             String?
  isActive          Boolean                 @default(true)
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  vacationStartDate DateTime?
  vacationEndDate   DateTime?
  monthlyBaseRate   Decimal?
  tenant            Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectLabours    ProjectLabour[]
  movementHistory   LabourMovementHistory[] @relation("LabourHistory")
  leaveHistory      LeaveHistory[]          @relation("LabourLeaveHistory")

  @@index([tenantId])
  @@map("labours")
}

model ProjectTrade {
  id                Int             @id @default(autoincrement())
  projectId         Int
  trade             String
  requiredQuantity  Int             @default(1)
  startDate         DateTime?
  endDate           DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  project           Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  labourAssignments ProjectLabour[]

  @@unique([projectId, trade])
  @@map("project_trades")
}

model ProjectLabour {
  id              Int                     @id @default(autoincrement())
  projectId       Int
  tradeId         Int
  labourId        Int?
  utilization     Int                     @default(100)
  startDate       DateTime?
  endDate         DateTime?
  status          String                  @default("Active")
  notes           String?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  labour          Labour?                 @relation(fields: [labourId], references: [id], onDelete: Cascade)
  trade           ProjectTrade            @relation(fields: [tradeId], references: [id], onDelete: Cascade)
  project         Project                 @relation(fields: [projectId], references: [id], onDelete: Cascade)
  movementHistory LabourMovementHistory[] @relation("ProjectLabourHistory")

  @@unique([projectId, labourId])
  @@map("project_labours")
}

model Plant {
  id               Int      @id @default(autoincrement())
  tenantId         Int      @default(1)
  plantDescription String
  plantCode        String
  plateNumber      String?
  plantType        String   @default("direct")
  isOwned          Boolean  @default(false)
  monthlyCost      Float
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectPlants     ProjectPlant[]

  @@unique([tenantId, plantCode])
  @@index([tenantId])
  @@map("plants")
}

model ProjectPlantRequirement {
  id               Int             @id @default(autoincrement())
  projectId        Int
  title            String
  description      String?
  requiredQuantity Int             @default(1)
  notes            String?
  plannedStartDate DateTime?
  plannedEndDate   DateTime?
  monthlyBudget    Float?
  useSlotDates            Boolean  @default(false)
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  project          Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignments      ProjectPlant[]
  slots            ProjectPlantRequirementSlot[]

  @@index([projectId])
  @@map("project_plant_requirements")
}

model ProjectPlant {
  id             Int       @id @default(autoincrement())
  projectId      Int
  plantId        Int?
  requirementId  Int?
  slotIndex      Int?
  startDate      DateTime?
  endDate        DateTime?
  status         String    @default("Active")
  notes          String?
  monthlyCost    Float?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  plant          Plant?    @relation(fields: [plantId], references: [id], onDelete: SetNull)
  requirement    ProjectPlantRequirement? @relation(fields: [requirementId], references: [id], onDelete: SetNull)

  @@index([projectId])
  @@index([plantId])
  @@index([requirementId])
  @@map("project_plants")
}

model ProjectPlantRequirementSlot {
  id            Int                      @id @default(autoincrement())
  requirementId Int
  slotIndex     Int
  startDate     DateTime?
  endDate       DateTime?
  plannedStartDate DateTime?
  plannedEndDate   DateTime?
  createdAt     DateTime                 @default(now())
  updatedAt     DateTime                 @updatedAt
  requirement   ProjectPlantRequirement  @relation(fields: [requirementId], references: [id], onDelete: Cascade)

  @@index([requirementId])
  @@unique([requirementId, slotIndex])
  @@map("project_plant_requirement_slots")
}

model LabourMovementHistory {
  id              Int            @id @default(autoincrement())
  labourId        Int
  type            String         @default("movement") // "assignment" or "movement"
  fromProjectId   Int?
  fromProjectName String?
  fromTradeId     Int?
  fromTradeName   String?
  toProjectId     Int
  toProjectName   String
  toTradeId       Int
  toTradeName     String
  movedBy         String? // Could be admin user ID or name
  movementDate    DateTime       @default(now())
  notes           String?
  createdAt       DateTime       @default(now())
  projectLabourId Int? // Reference to the ProjectLabour assignment
  labour          Labour         @relation("LabourHistory", fields: [labourId], references: [id], onDelete: Cascade)
  projectLabour   ProjectLabour? @relation("ProjectLabourHistory", fields: [projectLabourId], references: [id], onDelete: SetNull)

  @@index([labourId])
  @@index([toProjectId])
  @@map("labour_movement_history")
}

model LeaveHistory {
  id             Int           @id @default(autoincrement())
  entityType     String // "staff" or "labour"
  staffId        Int? // Reference to CompanyStaff if entityType is "staff"
  labourId       Int? // Reference to Labour if entityType is "labour"
  leaveStartDate DateTime
  leaveEndDate   DateTime
  returnDate     DateTime? // Optional return date if marked as returned
  isReturned     Boolean       @default(false)
  notes          String?
  createdBy      String? // Admin user who created the record
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  staff          CompanyStaff? @relation("StaffLeaveHistory", fields: [staffId], references: [id], onDelete: Cascade)
  labour         Labour?       @relation("LabourLeaveHistory", fields: [labourId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([labourId])
  @@index([entityType])
  @@index([leaveStartDate])
  @@index([leaveEndDate])
  @@map("leave_history")
}

model ProjectLabourSupply {
  id             Int      @id @default(autoincrement())
  projectId      Int
  trade          String
  numberOfLabour Int
  pricePerHour   Decimal
  startDate      DateTime?
  endDate        DateTime?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, trade])
  @@index([projectId])
  @@map("project_labour_supplies")
}

model ProjectHseChecklistItem {
  id           Int       @id @default(autoincrement())
  projectId    Int
  item         String
  plannedDate  DateTime?
  actualDate   DateTime?
  status       String?
  notes        String?
  sortOrder    Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  project      Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_hse_checklist_items")
}

model ProjectNocTrackerEntry {
  id                     Int       @id @default(autoincrement())
  projectId              Int
  nocNumber              String?
  permitType             String?
  plannedSubmissionDate  DateTime?
  actualSubmissionDate   DateTime?
  status                 String?
  expiryDate             DateTime?
  remarks                String?
  sortOrder              Int       @default(0)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  project                Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_noc_tracker_entries")
}

model ProjectRiskEntry {
  id        Int       @id @default(autoincrement())
  projectId Int
  riskItem  String
  impact    String?
  remarks   String?
  sortOrder Int       @default(0)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_risk_entries")
}

model TypeOfWork {
  id         Int        @id @default(autoincrement())
  name       String     @unique
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  supplierAssignments SupplierTypeOfWork[]

  @@map("type_of_works")
}

model Supplier {
  id              Int       @id @default(autoincrement())
  tenantId        Int       @default(1)
  name            String
  type            String
  contactPerson   String?
  contactNumber   String?
  email           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  typeOfWorks     SupplierTypeOfWork[]
  projectEvaluations ProjectVendorEvaluation[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("suppliers")
}

model SupplierTypeOfWork {
  supplierId  Int
  typeOfWorkId Int
  assignedAt  DateTime @default(now())

  supplier   Supplier   @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  typeOfWork TypeOfWork @relation(fields: [typeOfWorkId], references: [id], onDelete: Cascade)

  @@id([supplierId, typeOfWorkId])
  @@map("supplier_type_of_work")
}

model ProjectVendorEvaluation {
  id        Int      @id @default(autoincrement())
  projectId Int
  supplierId Int
  rating    String   // "VERY_GOOD", "GOOD", "POOR"
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  supplier  Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@unique([projectId, supplierId])
  @@map("project_vendor_evaluations")
}

model ProjectAreaOfConcern {
  id             Int       @id @default(autoincrement())
  projectId      Int
  description    String
  actionNeeded   String?
  startedDate    DateTime?
  resolutionDate DateTime?
  status         String    @default("Ongoing")
  remarks        String?
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_area_of_concerns")
}

model ProjectClientFeedback {
  id             Int       @id @default(autoincrement())
  projectId      Int       @unique
  rating         String?   // Excellent, Very Good, Good, Average, Below Expectation, Poor
  positivePoints Json?     // Array of strings
  negativePoints Json?     // Array of strings
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_client_feedback")
}

model ProjectAsset {
  id          Int       @id @default(autoincrement())
  projectId   Int
  type        String
  description String
  assetNumber String?
  status      String    @default("Active")
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("project_assets")
}

model ProjectPicture {
  id          Int          @id @default(autoincrement())
  projectId   Int
  mediaId     Int
  caption     String?
  sortOrder   Int          @default(0)
  isFeatured  Boolean      @default(false)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  project     Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  media       MediaLibrary @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([mediaId])
  @@index([projectId, isFeatured])
  @@map("project_pictures")
}

model ProjectCloseOutEntry {
  id             Int       @id @default(autoincrement())
  projectId      Int
  itemType       String
  totalRequired  Int?
  submitted      Int?
  approved       Int?
  underReview    Int?
  rejected       Int?
  sortOrder      Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  project        Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, itemType])
  @@index([projectId])
  @@index([sortOrder])
  @@map("project_close_out_entries")
}

model ConsultantToConsultantType {
  A                Int
  B                Int
  consultant_types ConsultantType @relation(fields: [B], references: [id], onDelete: Cascade)
  consultants      Consultant     @relation(fields: [A], references: [id], onDelete: Cascade)

  @@unique([A, B], map: "_ConsultantToConsultantType_AB_unique")
  @@index([B], map: "_ConsultantToConsultantType_B_index")
  @@map("_ConsultantToConsultantType")
}

model ProjectReport {
  id          Int       @id @default(autoincrement())
  projectId   Int
  userId      Int
  reportMonth Int       // 1-12
  reportYear  Int       // e.g., 2025
  reportData  Json      // JSON data from all project tabs
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user        AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, reportMonth, reportYear])
  @@index([projectId])
  @@index([userId])
  @@index([reportYear, reportMonth])
  @@map("project_reports")
}
